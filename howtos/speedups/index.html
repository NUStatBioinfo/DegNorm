<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">  
    <link rel="shortcut icon" href="../../img/favicon.ico">

    <title>Speed enhancements - DegNorm</title>

    <link href="../../css/bootstrap-custom.min.css" rel="stylesheet">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/font-hack/2.018/css/hack.min.css">
    <link href='//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700,700italic&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,700italic,400,300,600,700&subset=latin-ext,latin' rel='stylesheet' type='text/css'>
    <link href="../../css/base.css" rel="stylesheet">
    <link href="../../css/cinder.css" rel="stylesheet">
    <link rel="stylesheet" href="../../css/highlight.css">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

    <script src="https://ajax.googleapis.com/ajax/libs/webfont/1.5.18/webfont.js"></script>
    <script>
    WebFont.load({
        google: {
            families: ['Open Sans', 'PT Sans']
        }
    });
    </script>

    
</head>

<body>

    <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            

            <!-- Main title -->

            <a class="navbar-brand" href="../..">DegNorm</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                
                
                    <li >
                        <a href="../..">Home</a>
                    </li>
                
                
                
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">How-Tos <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../installation/">Installation</a>
</li>

                        
                            
<li >
    <a href="../run_the_pipeline/">Running DegNorm</a>
</li>

                        
                            
<li class="active">
    <a href="./">Speed enhancements</a>
</li>

                        
                            
<li >
    <a href="../posthoc_analysis/">Posthoc analysis</a>
</li>

                        
                        </ul>
                    </li>
                
                
                
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">About <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                        
                            
<li >
    <a href="../../about/license/">License</a>
</li>

                        
                            
<li >
    <a href="../../about/release/">Release notes</a>
</li>

                        
                        </ul>
                    </li>
                
                
                </ul>

            <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                            <i class="fa fa-search"></i> Search
                        </a>
                    </li>
                    <li >
                        <a rel="next" href="../run_the_pipeline/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../posthoc_analysis/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

    <div class="container">
        
        <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="first-level active"><a href="#degnorm-speed-enhancements">DegNorm speed enhancements</a></li>
            <li class="second-level"><a href="#distributed-pipeline-runs-with-degnorm_mpi">Distributed pipeline runs with degnorm_mpi</a></li>
                
            <li class="second-level"><a href="#downsampling-coverage-matrices">Downsampling coverage matrices</a></li>
                
                <li class="third-level"><a href="#impact">Impact</a></li>
            <li class="second-level"><a href="#skipping-baseline-selection">Skipping baseline selection</a></li>
                
                <li class="third-level"><a href="#impact_1">Impact</a></li>
    </ul>
</div></div>
        <div class="col-md-9" role="main">

<h1 id="degnorm-speed-enhancements">DegNorm speed enhancements</h1>
<hr />
<h2 id="distributed-pipeline-runs-with-degnorm_mpi">Distributed pipeline runs with <code>degnorm_mpi</code></h2>
<p>Use <code>degnorm_mpi</code> to distribute DegNorm over parallel compute nodes via MPI, the <a href="https://en.wikipedia.org/wiki/Message_Passing_Interface">Message Passing Interface standard</a>.
With MPI, preprocessing and coverage matrix approximations will scale by the number of available compute nodes. MPI also allows you to best exploit the embarrassingly parallel nature
 of the DegNorm workload.</p>
<p>See the <code>degnorm_mpi</code> example in the <a href="../run_the_pipeline/">usage docs</a>.</p>
<h2 id="downsampling-coverage-matrices">Downsampling coverage matrices</h2>
<p>The backbone of the DegNorm normalization pipeline is the non-negative matrix factorization with over-approximation (NMFOA) algorithm.
 NMFOA is a computationally expensive algorithm, requiring <code>--nmf-iter</code>-many singular value decompositions of the coverage matrix.
 The SVD is O(n^3) in terms of flop count (according to Trefethen and Bau), so genes with smaller coverage matrices will 
 naturally run through NMFOA faster than larger ones.</p>
<p>In an effort to trim down the coverage matrices, the <code>--downsample-rate</code> argument in <code>degnorm</code> allows you to use a <a href="https://en.wikipedia.org/wiki/Systematic_sampling">systematic sample</a> 
for each gene's coverage matrix in lieu of the larger original ones. The <code>--downsample-rate</code> is just the integer-valued
"take-every" step size, so that the original coverage matrix is reduced by a factor of 1 / (downsample rate). At a modest
 downsampling rate, the overall shape of the coverage curves should still be recognizable.</p>
<p><img alt="systematic_sample" src="../../img/systematic_sample.png" /></p>
<p>Obviously, the higher the downsampling rate, the faster the DegNorm iterations will complete, because DegNorm
executes SVD approximations on smaller and smaller gene coverage matrices. The figure below illustrates the time savings
at various downsampling rates from the 9-sample gliablastoma (GBM) cell line study data set:</p>
<p><img alt="gbm_dsample_speed_times" src="../../img/degnorm_dsamp_speeds.png" /></p>
<h3 id="impact">Impact</h3>
<p>We recreated the DE analysis using the GBM data as well as
the Sequencing Quality Control (SEQC) AA vs. AB data at various downsampling rates.
In comparison to the non-downsampled results (as in, 1/1 downsampling), we see that moderate downsampling - e.g. a rate of 1/20 - 
does not substantially impact DE analysis and still allow for DegNorm retains its edge over existing RNA-Seq normalization methods, while
offering 50%+ DegNorm iteration time savings.</p>
<p><strong>GBM RIN 10 vs. RIN 4 ECDF curve comparison</strong></p>
<p><img alt="gbm_dsample_R10vsR4_ecdf" src="../../img/dsamp_comparo_R6vsR4.png" /></p>
<p><strong>GBM RIN 6 vs. RIN 4 ECDF curve comparison</strong></p>
<p><img alt="gbm_dsample_R6vsR4_ecdf" src="../../img/dsamp_comparo_R6vsR4.png" /></p>
<p><strong>SEQC AA vs AB ROC curve comparison</strong></p>
<p><img alt="gbm_dsample_SEQC_ROC" src="../../img/dsamp_comparo_SEQC.png" /></p>
<p>To run DegNorm with downsampling, add <code>-d &lt;take every&gt;</code> (full option <code>--downsample-rate &lt;take every&gt;</code>) where
 <code>take every</code> is the integer step size for the systematic sample. Note that genes with total concatenated exon length
 less than the downsample rate will not be included in the DegNorm pipeline.</p>
<h2 id="skipping-baseline-selection">Skipping baseline selection</h2>
<p>The most expensive part of the DegNorm normalization algorithm is in finding a "baseline" region of non-degraded coverage
across all samples, a process referred to as <strong>baseline selection</strong>. In the event that that region is small, the approximation of a single gene's coverage curves may require
over a thousand SVDs.</p>
<p><strong>Skipping baseline selection offers the largest speedup</strong>, more than any level of downsampling,
but likely with a more heavy impact on DegNorm's performance. We cannot wholly endorse skipping baseline selection,
but for those who are seeking <em>ballpark</em> DegNorm results in an hour or two, this option may be for you.</p>
<h3 id="impact_1">Impact</h3>
<p>The impact of skipping baseline selection is experiment-specific, and is likely
due to the nature and extent of RNA degradation present in the samples. As is shown in the figure below,
the skipping baseline selection negatively impacts the SEQC AA/AB DE ROC curve.</p>
<p><img alt="nbs_roc_comparo" src="../../img/nbs_roc_comparo.png" /></p>
<p>At the same time, DegNorm still retains its
advantage over the existing normalization methods with respect to GBM p-value ECDF curves, even while skipping baseline selection.</p>
<p><img alt="nbs_ecdf_comparo" src="../../img/nbs_ecdf_comparo.png" /></p>
<p>Run DegNorm without baseline selection at your own risk by adding the <code>--skip-baseline-selection</code> flag at the command line.</p></div>
        
    </div>

    <footer class="col-md-12 text-center">
        <hr>
        <p>
        <small>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p></small>
    </footer>

    <script src="../../js/jquery-1.10.2.min.js"></script>
    <script src="../../js/bootstrap-3.0.3.min.js"></script>
    <script src="../../js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script>
    var base_url = '../..';
    </script>
    <script data-main="../../mkdocs/js/search.js" src="../../mkdocs/js/require.js"></script>
    <script src="../../js/base.js"></script>
    <script src="../../search/main.js"></script>

    <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">
                        <span aria-hidden="true">&times;</span>
                        <span class="sr-only">Close</span>
                    </button>
                    <h4 class="modal-title" id="exampleModalLabel">Search</h4>
                </div>
                <div class="modal-body">
                    <p>
                        From here you can search these documents. Enter your search terms below.
                    </p>
                    <form role="form">
                        <div class="form-group">
                            <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                        </div>
                    </form>
                    <div id="mkdocs-search-results"></div>
                </div>
                <div class="modal-footer">
                </div>
            </div>
        </div>
    </div>

    </body>

</html>
